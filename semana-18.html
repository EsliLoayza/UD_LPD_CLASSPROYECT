<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semana 18 - CODE ARCHITECT: THE DISTRIBUTED JOURNEY</title>
    <!-- Incluyendo Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Incluyendo Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700;900&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #0d0221;
            --color-primary: #00f5d4;
            --color-secondary: #9b5de5;
            --color-tertiary: #f15bb5;
            --color-accent: #fee440;
            --color-text: #f0eff4;
            --font-title: 'Exo 2', sans-serif;
            --font-code: 'Fira Code', monospace;
        }

        /* --- Estructura y Animaciones Globales --- */
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-code);
            background-color: var(--color-bg);
            color: var(--color-text);
            overflow-x: hidden;
            background-image: radial-gradient(var(--color-secondary) 0.5px, transparent 0.5px), radial-gradient(var(--color-primary) 0.5px, var(--color-bg) 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        .hidden { display: none !important; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 15px var(--color-accent); } 50% { transform: scale(1.05); box-shadow: 0 0 25px var(--color-accent); } }
        @keyframes glitch { 2%,64%{ transform: translate(2px,0) skew(0deg); } 4%,60%{ transform: translate(-2px,0) skew(0deg); } 62%{ transform: translate(0,0) skew(5deg); } }
        .glitch { animation: glitch 1s linear infinite; }

        /* --- Estilos de Componentes --- */
        .game-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            animation: fadeIn 0.8s ease-out;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
        }

        .title {
            font-family: var(--font-title);
            font-weight: 900;
            font-size: clamp(2.5rem, 10vw, 6rem);
            text-transform: uppercase;
            color: var(--color-primary);
            text-shadow: 0 0 5px var(--color-primary), 0 0 10px var(--color-primary), 0 0 20px var(--color-tertiary), 0 0 40px var(--color-tertiary);
            margin-bottom: 1rem;
        }

        .subtitle {
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: var(--color-text);
            margin-bottom: 2rem;
            text-align: center;
        }

        .btn {
            font-family: var(--font-title);
            background: transparent;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
            padding: 1rem 2rem;
            font-size: 1.2rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px var(--color-primary) inset;
        }
        .btn:hover { background-color: var(--color-primary); color: var(--color-bg); box-shadow: 0 0 20px var(--color-primary); }
        .btn-start { animation: pulse 2s infinite; }

        .game-panel {
            background: rgba(13, 2, 33, 0.8);
            border: 1px solid var(--color-secondary);
            backdrop-filter: blur(10px);
            padding: 2rem;
            width: 100%;
            box-shadow: 0 0 20px rgba(155, 93, 229, 0.5);
        }
        
        /* Estilos específicos del juego */
        .map-node {
            width: 100px; height: 100px;
            border: 2px solid var(--color-secondary);
            border-radius: 50%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: all 0.3s ease;
            position: relative;
        }
        .map-node.locked { filter: grayscale(1) brightness(0.5); cursor: not-allowed; border-color: #555; }
        .map-node.completed { border-color: var(--color-primary); box-shadow: 0 0 15px var(--color-primary); color: var(--color-primary); }
        .map-node:not(.locked):hover { transform: scale(1.1); background-color: var(--color-secondary); }
        .map-connector {
            position: absolute;
            height: 2px;
            background: var(--color-secondary);
            transform-origin: left center;
        }

        .quiz-option {
            display: block; width: 100%; text-align: left;
            background-color: transparent; border: 1px solid var(--color-tertiary);
            padding: 1rem; margin-bottom: 1rem; color: var(--color-text);
            cursor: pointer; transition: all 0.2s;
        }
        .quiz-option:hover { background-color: var(--color-tertiary); color: var(--color-bg); }
        .quiz-option.correct { background-color: var(--color-primary); color: var(--color-bg); border-color: var(--color-primary); }
        .quiz-option.incorrect { background-color: #e63946; color: var(--color-text); border-color: #e63946; }

        /* Drag and Drop styles */
        .drop-zone { border: 2px dashed #9b5de5; min-height: 150px; padding: 1rem; transition: background-color 0.3s; }
        .drag-item { background: #1a0b33; border: 1px solid #9b5de5; padding: 0.5rem; margin: 0.5rem; cursor: grab; text-align: center; }
        .drop-zone.over { background-color: rgba(155, 93, 229, 0.3); }
        
        .final-dedication {
            margin-top: 3rem;
            font-size: 1.5rem;
            color: var(--color-accent);
            text-shadow: 0 0 10px var(--color-accent);
        }
    </style>
</head>
<body>

    <!-- Pantalla de Inicio -->
    <div id="start-screen" class="game-screen">
        <h1 class="title glitch">CODE ARCHITECT</h1>
        <p class="subtitle">THE DISTRIBUTED JOURNEY</p>
        <button id="start-btn" class="btn btn-start">INICIAR MISIÓN</button>
    </div>

    <!-- Mapa de Misión -->
    <div id="map-screen" class="game-screen hidden">
        <div class="container text-center">
            <h2 class="text-3xl font-bold uppercase mb-2" style="font-family: var(--font-title);">Mapa de la Misión</h2>
            <p class="mb-8">Completa cada nodo para desbloquear el siguiente y construir el sistema.</p>
            <div class="relative flex justify-around items-center w-full max-w-4xl mx-auto">
                <!-- Conectores -->
                <div class="map-connector" style="width: 20%; left: 15%; top: 50%;"></div>
                <div class="map-connector" style="width: 20%; left: 40%; top: 50%;"></div>
                <div class="map-connector" style="width: 20%; left: 65%; top: 50%;"></div>
                
                <!-- Nodos -->
                <div id="node-1" class="map-node" data-node="1"><i class="fas fa-desktop text-3xl mb-1"></i><span>Fundación</span></div>
                <div id="node-2" class="map-node locked" data-node="2"><i class="fas fa-plug text-3xl mb-1"></i><span>Conexión</span></div>
                <div id="node-3" class="map-node locked" data-node="3"><i class="fas fa-sitemap text-3xl mb-1"></i><span>Arquitectura</span></div>
                <div id="node-4" class="map-node locked" data-node="4"><i class="fas fa-cogs text-3xl mb-1"></i><span>Ensamblaje</span></div>
                <div id="node-5" class="map-node locked" data-node="5"><i class="fas fa-rocket text-3xl mb-1"></i><span>Lanzamiento</span></div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Nodos (Contenido dinámico) -->
    <div id="node-screen" class="game-screen hidden">
        <div class="container">
            <div id="node-content" class="game-panel">
                <!-- El contenido del desafío se inyectará aquí -->
            </div>
        </div>
    </div>
    
    <!-- Pantalla Final -->
    <div id="final-screen" class="game-screen hidden">
        <h1 class="title glitch">MISIÓN CUMPLIDA</h1>
        <i class="fas fa-trophy text-9xl text-yellow-400 my-8" style="filter: drop-shadow(0 0 20px var(--color-accent));"></i>
        <p class="subtitle">¡Has construido y desplegado el sistema con éxito! <br> Tu viaje como Arquitecto de Código ha sido completado.</p>
        <p class="final-dedication">Un proyecto formativo del <br> DOC. JUAN ESLÍ LOAYZA MÁRQUEZ</p>
        <button id="restart-btn" class="btn mt-8">Jugar de Nuevo</button>
    </div>

    <script>
        // --- Game State ---
        const gameState = {
            currentNode: 0,
            completedNodes: [],
        };

        // --- DOM Elements ---
        const screens = {
            start: document.getElementById('start-screen'),
            map: document.getElementById('map-screen'),
            node: document.getElementById('node-screen'),
            final: document.getElementById('final-screen'),
        };
        const nodeContentEl = document.getElementById('node-content');

        // --- Game Data ---
        const gameData = {
            1: {
                title: "NODO 1: La Fundación (UI y Datos en Memoria)",
                challenge: `
                    <p class="mb-4">El cliente necesita una interfaz para gestionar 'Agentes'. Arrastra los controles necesarios para crear, listar y mostrar detalles de un agente (ID, Nombre, Nivel).</p>
                    <div class="flex gap-4">
                        <div class="w-1/3">
                            <h3 class="font-bold text-center mb-2">Controles Disponibles</h3>
                            <div id="drag-source">
                                <div class="drag-item" draggable="true" data-control="TextBox">TextBox (Entrada de texto)</div>
                                <div class="drag-item" draggable="true" data-control="Button">Button (Acción)</div>
                                <div class="drag-item" draggable="true" data-control="ListBox">ListBox (Lista Simple)</div>
                                <div class="drag-item" draggable="true" data-control="DataGridView">DataGridView (Tabla)</div>
                            </div>
                        </div>
                        <div class="w-2/3">
                             <h3 class="font-bold text-center mb-2">Panel de Diseño</h3>
                             <div id="drop-target" class="drop-zone"></div>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button class="btn" onclick="checkNode1()">Verificar Diseño</button>
                    </div>
                `,
            },
            2: {
                 title: "NODO 2: La Conexión (ADO.NET y SQL)",
                 challenge: `
                    <p class="mb-4">¡Alerta de seguridad! El siguiente código es vulnerable a Inyección SQL. Elige la opción que representa una consulta parametrizada segura.</p>
                    <div style="background: #000; padding: 1rem; margin-bottom: 1rem;">
                        <code>string query = "SELECT * FROM agents WHERE name = '" + txtName.Text + "';";</code>
                    </div>
                    <div id="quiz-options">
                        <button class="quiz-option" onclick="checkNode2(false)">A) <code>string query = "SELECT * FROM agents WHERE name = '" + Sanitize(txtName.Text) + "';";</code></button>
                        <button class="quiz-option" onclick="checkNode2(true)">B) <code>string query = "SELECT * FROM agents WHERE name = @name;"; cmd.Parameters.AddWithValue("@name", txtName.Text);</code></button>
                        <button class="quiz-option" onclick="checkNode2(false)">C) <code>string query = "EXEC sp_GetAgentByName '" + txtName.Text + "';";</code></button>
                    </div>
                 `,
            },
            3: {
                title: "NODO 3: La Arquitectura (POO y UML)",
                challenge: `
                    <p class="mb-4">El sistema necesita una arquitectura limpia. Arrastra las responsabilidades a su capa correcta para desacoplar el sistema.</p>
                     <div class="flex gap-4">
                        <div class="w-1/3">
                            <h3 class="font-bold text-center mb-2">Responsabilidades</h3>
                            <div id="drag-source">
                                <div class="drag-item" draggable="true" data-layer="UI">Mostrar MessageBox de error</div>
                                <div class="drag-item" draggable="true" data-layer="BLL">if (nivel > 10) { ... }</div>
                                <div class="drag-item" draggable="true" data-layer="DAL">connection.Open();</div>
                            </div>
                        </div>
                        <div class="w-2/3">
                             <h3 class="font-bold text-center mb-2">Capas Arquitectónicas</h3>
                             <div class="drop-zone mb-2" data-target="UI"><p>UI (Presentación)</p></div>
                             <div class="drop-zone mb-2" data-target="BLL"><p>BLL (Lógica de Negocio)</p></div>
                             <div class="drop-zone" data-target="DAL"><p>DAL (Acceso a Datos)</p></div>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button class="btn" onclick="checkNode3()">Verificar Arquitectura</button>
                    </div>
                `,
            },
            4: {
                 title: "NODO 4: El Ensamblaje (DLLs)",
                 challenge: `
                    <p class="mb-4">Has compilado tu lógica en una DLL llamada 'BusinessLogic.dll'. ¿Cómo la utilizas en tu proyecto de Interfaz de Usuario (UI)?</p>
                    <div id="quiz-options">
                        <button class="quiz-option" onclick="checkNode4(false)">A) Copiando y pegando el código fuente de la BLL en el proyecto UI.</button>
                        <button class="quiz-option" onclick="checkNode4(false)">B) Usando la directiva '#include "BusinessLogic.dll"' al inicio del formulario.</button>
                        <button class="quiz-option" onclick="checkNode4(true)">C) Agregando una referencia al proyecto BLL (o al archivo DLL) en el proyecto UI.</button>
                    </div>
                 `,
            },
            5: {
                title: "NODO 5: Lanzamiento (Revisión Final)",
                challenge: `
                    <p class="mb-4">Para asegurar que una conexión a la base de datos siempre se cierre, incluso si ocurre un error, ¿en qué bloque de un 'try-catch' debería ir el método <code>connection.Close()</code>?</p>
                     <div id="quiz-options">
                        <button class="quiz-option" onclick="checkNode5(false)">A) En el bloque 'try'.</button>
                        <button class="quiz-option" onclick="checkNode5(false)">B) En el bloque 'catch'.</button>
                        <button class="quiz-option" onclick="checkNode5(true)">C) En el bloque 'finally'.</button>
                    </div>
                `,
            }
        };

        // --- Game Logic ---
        function showScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.add('hidden'));
            screens[screenName].classList.remove('hidden');
        }

        function startGame() {
            gameState.currentNode = 0;
            gameState.completedNodes = [];
            updateMap();
            showScreen('map');
        }

        function updateMap() {
            for (let i = 1; i <= 5; i++) {
                const nodeEl = document.getElementById(`node-${i}`);
                nodeEl.classList.remove('completed', 'locked');
                
                if (gameState.completedNodes.includes(i)) {
                    nodeEl.classList.add('completed');
                } else if (i > gameState.completedNodes.length + 1) {
                    nodeEl.classList.add('locked');
                }
            }
        }
        
        function selectNode(nodeId) {
            if (document.getElementById(`node-${nodeId}`).classList.contains('locked')) return;
            gameState.currentNode = nodeId;
            const nodeData = gameData[nodeId];
            nodeContentEl.innerHTML = `<h2 class="text-2xl font-bold mb-4 text-center" style="font-family: var(--font-title);">${nodeData.title}</h2>${nodeData.challenge}`;
            showScreen('node');

            if (nodeId === 1 || nodeId === 3) {
                 setupDragDrop();
            }
        }
        
        function completeNode(nodeId) {
            if (!gameState.completedNodes.includes(nodeId)) {
                gameState.completedNodes.push(nodeId);
            }
            alert(`¡NODO ${nodeId} COMPLETADO!`);
            
            if (gameState.completedNodes.length === 5) {
                showScreen('final');
            } else {
                updateMap();
                showScreen('map');
            }
        }
        
        // --- Drag & Drop Logic ---
        function setupDragDrop() {
            const draggables = document.querySelectorAll('.drag-item');
            const dropzones = document.querySelectorAll('.drop-zone');
            let draggedItem = null;

            draggables.forEach(item => {
                item.addEventListener('dragstart', (e) => { draggedItem = e.target; });
            });
            dropzones.forEach(zone => {
                zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('over'); });
                zone.addEventListener('dragleave', () => zone.classList.remove('over'));
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('over');
                    if (draggedItem) zone.appendChild(draggedItem);
                });
            });
        }
        
        // --- Node Checkers ---
        function checkNode1() {
            const dropTarget = document.getElementById('drop-target');
            const controls = new Set();
            dropTarget.querySelectorAll('.drag-item').forEach(item => controls.add(item.dataset.control));
            if (controls.has('TextBox') && controls.has('Button') && controls.has('DataGridView')) {
                completeNode(1);
            } else {
                alert('Diseño incorrecto. Faltan controles esenciales para el CRUD.');
            }
        }

        function checkNode2(isCorrect, element) {
            document.querySelectorAll('.quiz-option').forEach(el => el.disabled = true);
            element.classList.add(isCorrect ? 'correct' : 'incorrect');
            if (isCorrect) setTimeout(() => completeNode(2), 1000);
        }

        function checkNode3() {
            const zones = document.querySelectorAll('.drop-zone');
            let isCorrect = true;
            zones.forEach(zone => {
                const items = zone.querySelectorAll('.drag-item');
                if (items.length !== 1 || items[0].dataset.layer !== zone.dataset.target) {
                    isCorrect = false;
                }
            });
            if(isCorrect) completeNode(3);
            else alert('Arquitectura incorrecta. Revisa la responsabilidad de cada capa.');
        }

        function checkNode4(isCorrect, element) {
            document.querySelectorAll('.quiz-option').forEach(el => el.disabled = true);
            element.classList.add(isCorrect ? 'correct' : 'incorrect');
            if (isCorrect) setTimeout(() => completeNode(4), 1000);
        }
        
        function checkNode5(isCorrect, element) {
             document.querySelectorAll('.quiz-option').forEach(el => el.disabled = true);
            element.classList.add(isCorrect ? 'correct' : 'incorrect');
            if (isCorrect) setTimeout(() => completeNode(5), 1000);
        }

        // --- Event Listeners ---
        document.getElementById('start-btn').addEventListener('click', startGame);
        document.getElementById('restart-btn').addEventListener('click', () => showScreen('start'));
        document.querySelectorAll('.map-node').forEach(node => {
            node.addEventListener('click', () => selectNode(parseInt(node.dataset.node)));
        });

    </script>
</body>
</html>
