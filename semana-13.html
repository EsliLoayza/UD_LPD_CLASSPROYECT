<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPD - Semana 13: Taller de Ensamblaje de Componentes</title>
    <!-- Incluyendo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluyendo Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Incluyendo Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Fira+Code&family=Exo+2:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0;}
        .exo-title { font-family: 'Exo-2', sans-serif; }
        .code-block { background-color: #1e293b; border: 1px solid #334155; border-radius: 0.5rem; font-family: 'Fira-Code', monospace; padding: 1rem; font-size: 0.875rem; line-height: 1.6; white-space: pre-wrap; }
        .station { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid #475569; border-radius: 0.75rem; padding: 1.5rem; }
        .draggable { cursor: grab; transition: all 0.2s ease-in-out; }
        .draggable:active { cursor: grabbing; transform: scale(1.05); box-shadow: 0 0 20px rgba(56, 189, 248, 0.5); }
        .drop-zone { border: 2px dashed #475569; transition: all 0.2s; }
        .drop-zone.over { background-color: #334155; border-color: #38bdf8; }
        .component { transition: opacity 0.5s, transform 0.5s; }
        .connector { position: absolute; border: 2px solid #64748b; border-style: dashed; z-index: -1; }
        .status-light { width: 12px; height: 12px; border-radius: 50%; transition: background-color 0.5s; }
        .status-light.off { background-color: #475569; }
        .status-light.on { background-color: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .animated-arrow { animation: flash 1.5s infinite; }
        @keyframes flash { 0%, 100% { color: #94a3b8; } 50% { color: #38bdf8; } }
    </style>
</head>
<body class="antialiased">

    <!-- Contenedor Principal -->
    <div class="container mx-auto p-4 sm:p-6 md:p-8">

        <!-- Cabecera -->
        <header class="bg-gradient-to-r from-slate-900 to-slate-800 border-2 border-sky-500 shadow-2xl shadow-sky-500/20 rounded-lg p-8 mb-8 text-center">
            <i class="fas fa-cogs text-5xl mb-4 text-sky-400"></i>
            <h1 class="text-5xl font-bold exo-title text-white">Semana 13: Taller de Ensamblaje</h1>
            <p class="text-xl mt-2 text-slate-400">Transforma tu código en componentes reutilizables (DLLs).</p>
        </header>

        <!-- Taller Interactivo -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
            
            <!-- Estación 1: Código Fuente -->
            <div class="station lg:col-span-1">
                <h2 class="text-2xl font-bold exo-title text-white mb-4">Estación 1: Código Fuente</h2>
                <p class="text-slate-400 mb-4 text-sm">Arrastra las clases a la máquina compiladora correcta para crear tus componentes DLL.</p>
                <div class="space-y-4">
                    <div id="drag-bll" class="draggable p-4 bg-slate-800 rounded-lg border border-slate-600">
                        <p class="font-bold"><i class="fas fa-box-open mr-2 text-green-400"></i>Producto.cs (Entidad)</p>
                        <p class="text-xs text-slate-400">Define qué es un Producto.</p>
                    </div>
                    <div id="drag-dal" class="draggable p-4 bg-slate-800 rounded-lg border border-slate-600">
                        <p class="font-bold"><i class="fas fa-database mr-2 text-yellow-400"></i>ProductoDatos.cs (Datos)</p>
                        <p class="text-xs text-slate-400">Sabe cómo hablar con la BD.</p>
                    </div>
                </div>
            </div>

            <!-- Estación 2: Compilador -->
            <div class="station lg:col-span-1">
                <h2 class="text-2xl font-bold exo-title text-white mb-4">Estación 2: Compilador</h2>
                <div id="drop-bll" class="drop-zone p-6 rounded-lg text-center mb-4">
                    <i class="fas fa-microchip text-4xl text-green-400"></i>
                    <p class="mt-2 font-semibold">Compilador BLL</p>
                    <p class="text-xs text-slate-400">Arrastra aquí las clases de Entidad.</p>
                </div>
                <div id="drop-dal" class="drop-zone p-6 rounded-lg text-center">
                    <i class="fas fa-server text-4xl text-yellow-400"></i>
                    <p class="mt-2 font-semibold">Compilador DAL</p>
                    <p class="text-xs text-slate-400">Arrastra aquí las clases de Datos.</p>
                </div>
            </div>

            <!-- Estación 3: Ensamblaje Final -->
            <div class="station lg:col-span-1">
                <h2 class="text-2xl font-bold exo-title text-white mb-4">Estación 3: Ensamblaje</h2>
                <p class="text-slate-400 mb-4 text-sm">Una vez compilados, los componentes DLL aparecerán aquí. Conéctalos a la aplicación.</p>
                
                <div class="relative bg-slate-900 p-6 rounded-lg border border-slate-700">
                    <div id="app-box" class="text-center">
                         <i class="fas fa-desktop text-4xl text-sky-400"></i>
                         <p class="font-bold mt-2">MiTienda.App.exe</p>
                         <div class="flex justify-center items-center mt-2 space-x-4">
                             <div class="status-light off" id="light-bll"></div>
                             <div class="status-light off" id="light-dal"></div>
                         </div>
                    </div>
                    
                    <div id="comp-bll" data-ref="bll" class="component draggable absolute -left-28 top-0 opacity-0 transform -translate-x-10 p-2 bg-green-900/50 border border-green-500 rounded text-center">
                        <i class="fas fa-file-code"></i>
                        <p class="text-xs font-bold">BLL.dll</p>
                    </div>
                    <div id="comp-dal" data-ref="dal" class="component draggable absolute -left-28 top-20 opacity-0 transform -translate-x-10 p-2 bg-yellow-900/50 border border-yellow-500 rounded text-center">
                        <i class="fas fa-file-invoice"></i>
                        <p class="text-xs font-bold">DAL.dll</p>
                    </div>
                </div>
                 <div id="result-code" class="mt-4 code-block h-24 text-slate-400">// Las referencias aparecerán aquí...</div>
            </div>
        </main>
        
        <!-- Navegación -->
        <footer class="mt-12">
            <div class="flex justify-between items-center bg-slate-800 p-4 rounded-lg shadow-md">
                <a href="semana-12.html" class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded transition duration-300 flex items-center"><i class="fas fa-arrow-left mr-2"></i>Anterior</a>
                <span class="font-semibold text-slate-500">Semana 13 de 18</span>
                <a href="semana-14.html" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded transition duration-300 flex items-center">Siguiente<i class="fas fa-arrow-right ml-2"></i></a>
            </div>
            <div class="text-center mt-4 text-sm text-gray-500">
                <p>Instituto de Educación Superior Tecnológico Público "Carlos Salazar Romero"</p>
            </div>
        </footer>
    </div>
    
    <script>
        const draggableBLL = document.getElementById('drag-bll');
        const draggableDAL = document.getElementById('drag-dal');
        const dropZoneBLL = document.getElementById('drop-bll');
        const dropZoneDAL = document.getElementById('drop-dal');
        const componentBLL = document.getElementById('comp-bll');
        const componentDAL = document.getElementById('comp-dal');
        const lightBLL = document.getElementById('light-bll');
        const lightDAL = document.getElementById('light-dal');
        const resultCode = document.getElementById('result-code');
        const appBox = document.getElementById('app-box');

        let isBLLCompiled = false;
        let isDALCompiled = false;
        let isBLLReferenced = false;
        let isDALReferenced = false;

        function setupDraggable(element, dropZone, onDropCallback) {
            element.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', element.id);
                setTimeout(() => element.style.display = 'none', 0);
            });
            element.addEventListener('dragend', () => {
                 if(!((element.id.includes('bll') && isBLLCompiled) || (element.id.includes('dal') && isDALCompiled))) {
                     element.style.display = 'block';
                 }
            });
        }
        
        function setupDropZone(dropZone, acceptedId, onDropCallback) {
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('over');
            });
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('over'));
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('over');
                const id = e.dataTransfer.getData('text/plain');
                if (id === acceptedId) {
                    onDropCallback();
                }
            });
        }

        setupDraggable(draggableBLL, dropZoneBLL);
        setupDraggable(draggableDAL, dropZoneDAL);

        setupDropZone(dropZoneBLL, 'drag-bll', () => {
            isBLLCompiled = true;
            componentBLL.style.opacity = '1';
            componentBLL.style.transform = 'translateX(0)';
            draggableBLL.style.display = 'none';
        });

        setupDropZone(dropZoneDAL, 'drag-dal', () => {
            isDALCompiled = true;
            componentDAL.style.opacity = '1';
            componentDAL.style.transform = 'translateX(0)';
            draggableDAL.style.display = 'none';
        });

        // Dragging components to the app
        let draggedComponent = null;
        [componentBLL, componentDAL].forEach(comp => {
            comp.addEventListener('dragstart', (e) => {
                draggedComponent = e.target;
            });
        });

        appBox.addEventListener('dragover', (e) => e.preventDefault());
        appBox.addEventListener('drop', (e) => {
            if (draggedComponent) {
                const ref = draggedComponent.dataset.ref;
                if (ref === 'bll' && isBLLCompiled) {
                    isBLLReferenced = true;
                    lightBLL.classList.remove('off');
                    lightBLL.classList.add('on');
                }
                if (ref === 'dal' && isDALCompiled) {
                    isDALReferenced = true;
                    lightDAL.classList.remove('off');
                    lightDAL.classList.add('on');
                }
                updateResultCode();
                draggedComponent.style.display = 'none';
            }
        });

        function updateResultCode() {
            let code = `// Referencias del Proyecto App.exe:\n`;
            if (isBLLReferenced) {
                code += `<ProjectReference Include="..\\BLL\\BLL.csproj" />\n`;
            }
            if (isDALReferenced) {
                code += `<ProjectReference Include="..\\DAL\\DAL.csproj" />\n`;
            }
            if (isBLLReferenced && isDALReferenced) {
                code += `\n// ¡Sistema modularizado con éxito!`;
            }
            resultCode.textContent = code;
        }

    </script>
</body>
</html>
