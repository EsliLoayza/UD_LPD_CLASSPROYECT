<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPD - Semana 06: El Detective de Datos</title>
    <!-- Incluyendo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluyendo Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Incluyendo Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #d1d5db; }
        .code-block {
            background-color: #1f2937; color: #a5b4fc; border-radius: 0.5rem;
            font-family: 'Fira Code', monospace; position: relative;
            border: 1px solid #374151;
        }
        .code-block .copy-btn {
            position: absolute; top: 0.5rem; right: 0.5rem; background-color: #4b5563;
            color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 0.25rem;
            cursor: pointer; opacity: 0.3; transition: all 0.3s;
        }
        .code-block:hover .copy-btn { opacity: 1; }
        .interactive-section { transition: all 0.3s ease-in-out; }
    </style>
</head>
<body class="antialiased">

    <!-- Contenedor Principal -->
    <div class="container mx-auto p-4 sm:p-6 md:p-8">

        <!-- Cabecera -->
        <header class="bg-gray-900 border border-gray-700 shadow-xl rounded-lg p-8 mb-8 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full bg-cover bg-center opacity-10" style="background-image: url('https://placehold.co/1200x300/111827/374151?text=DATA');"></div>
            <i class="fas fa-search text-5xl mb-4 text-indigo-400"></i>
            <h1 class="text-4xl font-bold text-white">Semana 06: El Detective de Datos</h1>
            <p class="text-xl mt-2 text-gray-400">Haciendo las preguntas correctas a la Base de Datos con SQL.</p>
        </header>

        <!-- Contenido Principal -->
        <main class="space-y-12">
            
            <!-- Constructor de Consultas Interactivo -->
            <section id="builder" class="interactive-section bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
                <h2 class="text-3xl font-bold text-white mb-4 flex items-center"><i class="fas fa-wrench text-indigo-400 mr-3"></i>Constructor de Consultas SQL</h2>
                <p class="mb-6 text-gray-400">Usa esta herramienta para entender cómo se arma una consulta. Marca las columnas que quieres ver y escribe tu condición de filtro.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Configuración de la consulta -->
                    <div class="space-y-4">
                        <div>
                            <label class="font-bold text-white">1. SELECT (¿Qué columnas?)</label>
                            <div class="flex flex-wrap gap-4 mt-2" id="column-selector">
                                <label class="flex items-center space-x-2"><input type="checkbox" data-col="id" class="form-checkbox h-5 w-5 bg-gray-700 border-gray-600 text-indigo-500" checked><span>id</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-col="nombre" class="form-checkbox h-5 w-5 bg-gray-700 border-gray-600 text-indigo-500" checked><span>nombre</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-col="precio" class="form-checkbox h-5 w-5 bg-gray-700 border-gray-600 text-indigo-500" checked><span>precio</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" data-col="stock" class="form-checkbox h-5 w-5 bg-gray-700 border-gray-600 text-indigo-500"><span>stock</span></label>
                            </div>
                        </div>
                        <div>
                            <p class="font-bold text-white">2. FROM (¿De qué tabla?)</p>
                            <p class="text-indigo-400 font-mono mt-2 p-2 bg-gray-900 rounded">productos</p>
                        </div>
                        <div>
                            <label for="where-clause" class="font-bold text-white">3. WHERE (¿Qué filas?)</label>
                            <div class="flex items-center mt-2">
                                <span class="font-mono text-gray-400 mr-2">precio ></span>
                                <input type="text" id="where-clause" value="100" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            </div>
                        </div>
                    </div>
                    <!-- Resultado de la consulta -->
                    <div>
                        <p class="font-bold text-white">Tu Consulta SQL Resultante:</p>
                        <div id="query-output" class="code-block mt-2 p-4 text-lg">
                            <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                            <pre><code id="sql-code"></code></pre>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Simulador de SQL Injection -->
            <section id="injector" class="interactive-section bg-red-900 bg-opacity-20 border border-red-500 p-6 rounded-lg shadow-lg">
                 <h2 class="text-3xl font-bold text-white mb-4 flex items-center"><i class="fas fa-user-secret text-red-400 mr-3"></i>Laboratorio de Ciberseguridad: SQL Injection</h2>
                 <p class="mb-6 text-gray-300">Ve por qué NUNCA debes concatenar strings para tus consultas. Prueba un nombre normal y luego un ataque.</p>
                 <div class="space-y-4">
                    <div>
                        <label for="user-input" class="font-bold text-white">Entrada del Usuario (en un TextBox):</label>
                        <input type="text" id="user-input" value="Juan" class="w-full p-2 bg-gray-700 border border-gray-600 rounded mt-2 text-white">
                    </div>
                    <div>
                        <p class="font-bold text-white">Consulta Vulnerable Resultante:</p>
                        <div id="vulnerable-query-output" class="code-block mt-2 p-4 text-red-400"></div>
                    </div>
                     <div>
                        <p class="font-bold text-white">Resultado de la Operación:</p>
                        <div id="attack-result" class="mt-2 p-4 rounded text-center text-lg font-bold transition-all duration-300"></div>
                    </div>
                 </div>
                 <div class="mt-6 border-t border-green-500 pt-4">
                     <h3 class="text-xl font-bold text-green-400">La Solución: Consulta Parametrizada</h3>
                     <p class="text-gray-300 mt-2">Con este método, el ataque es neutralizado. El valor se trata siempre como texto, nunca como código.</p>
                      <div class="code-block mt-2 p-4 text-green-400">
                         <p><span class="text-gray-400">comando.Parameters.AddWithValue(</span>"@nombre", <span class="text-yellow-400">userInput</span><span class="text-gray-400">);</span></p>
                     </div>
                 </div>
            </section>

            <!-- Actividad -->
            <section class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
                <h2 class="text-3xl font-bold text-white mb-4 flex items-center"><i class="fas fa-laptop-code text-indigo-400 mr-3"></i>Actividad de Aprendizaje N° 06</h2>
                <div>
                    <h3 class="text-xl font-semibold text-white">Ejercicio: Buscador de Productos Seguro</h3>
                    <p class="mt-2 text-gray-400">Crea una aplicación con un buscador de productos. El usuario debe poder escribir parte del nombre de un producto y ver los resultados en una grilla. Es **OBLIGATORIO** usar **consultas parametrizadas** para proteger la aplicación.</p>
                </div>
            </section>

        </main>

        <!-- Navegación -->
        <footer class="mt-12">
            <div class="flex justify-between items-center bg-gray-900 border border-gray-700 p-4 rounded-lg shadow-md">
                <a href="semana-05.html" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded transition duration-300 flex items-center"><i class="fas fa-arrow-left mr-2"></i>Anterior</a>
                <span class="text-gray-400 font-semibold">Semana 6 de 18</span>
                <a href="semana-07.html" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded transition duration-300 flex items-center">Siguiente<i class="fas fa-arrow-right ml-2"></i></a>
            </div>
            <div class="text-center mt-4 text-sm text-gray-500">
                <p>Instituto de Educación Superior Tecnológico Público "Carlos Salazar Romero"</p>
            </div>
        </footer>
    </div>
    
    <script>
        // --- Interactivity for Query Builder ---
        const colSelector = document.getElementById('column-selector');
        const whereInput = document.getElementById('where-clause');
        const sqlCode = document.getElementById('sql-code');
        
        function updateQuery() {
            const selectedCols = Array.from(colSelector.querySelectorAll('input:checked'))
                                     .map(cb => cb.dataset.col)
                                     .join(', ');
            const cols = selectedCols || '*';
            const whereVal = whereInput.value.trim();
            const whereClause = whereVal ? `\nWHERE ${whereInput.previousElementSibling.textContent}${whereVal};` : ';';
            
            sqlCode.innerHTML = `<span class="text-purple-400">SELECT</span> ${cols}\n<span class="text-purple-400">FROM</span> productos${whereClause}`;
        }
        
        colSelector.addEventListener('change', updateQuery);
        whereInput.addEventListener('input', updateQuery);
        
        // --- Interactivity for SQL Injection Simulator ---
        const userInput = document.getElementById('user-input');
        const vulnerableQueryOutput = document.getElementById('vulnerable-query-output');
        const attackResult = document.getElementById('attack-result');

        function simulateAttack() {
            const input = userInput.value;
            const query = `SELECT * FROM usuarios WHERE nombre = '<span class="text-yellow-400">${input}</span>';`;
            vulnerableQueryOutput.innerHTML = query;

            if (input.toLowerCase().includes("' or '1'='1")) {
                attackResult.textContent = '¡ACCESO TOTAL CONCEDIDO! El atacante ha bypassado la seguridad.';
                attackResult.className = 'mt-2 p-4 rounded text-center text-lg font-bold bg-red-500 text-white';
            } else {
                attackResult.textContent = 'Acceso Normal. El usuario fue encontrado (o no).';
                attackResult.className = 'mt-2 p-4 rounded text-center text-lg font-bold bg-green-500 text-white';
            }
        }

        userInput.addEventListener('input', simulateAttack);
        
        // --- General ---
        function copyCode(button) {
            const code = button.parentElement.querySelector('pre code').innerText;
            navigator.clipboard.writeText(code).then(() => {
                const originalIcon = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => { button.innerHTML = originalIcon; }, 1500);
            });
        }
        
        // Initial calls
        updateQuery();
        simulateAttack();
    </script>
</body>
</html>
